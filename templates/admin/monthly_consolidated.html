<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Consolidated Sheet - Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .consolidated-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        .card-header-custom {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
        }
        .summary-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4e73df;
        }
        .summary-item.positive {
            border-left-color: #28a745;
        }
        .summary-item.negative {
            border-left-color: #dc3545;
        }
        .summary-item.warning {
            border-left-color: #ffc107;
        }
        .summary-label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 600;
            text-transform: uppercase;
        }
        .summary-value {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
        }
        .transaction-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        .badge-donation {
            background: #d4edda;
            color: #155724;
        }
        .badge-expenditure {
            background: #f8d7da;
            color: #721c24;
        }
        .badge-approval {
            background: #fff3cd;
            color: #856404;
        }
        .month-selector {
            max-width: 200px;
        }
        /* Responsive improvements */
        @media (max-width: 768px) {
            .summary-grid {
                grid-template-columns: 1fr;
            }
            .d-flex {
                flex-direction: column;
            }
            .month-selector {
                max-width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-file-invoice-dollar text-primary"></i>
                    Monthly Consolidated Sheet
                </h1>
                <p class="text-muted">Financial overview for {{ month_name }}</p>
            </div>
            <div class="d-flex gap-2 align-items-center flex-wrap">
                <!-- Month Selector -->
                <select class="form-select month-selector" onchange="window.location.href='?month=' + this.value">
                    {% for month_option in available_months %}
                    <option value="{{ month_option.month_year }}" {% if month_option.month_year == selected_month %}selected{% endif %}>
                        {{ month_option.month_year }}
                    </option>
                    {% endfor %}
                </select>

                <!-- Download Button -->
                <a href="{{ url_for('download_consolidated_pdf', month=selected_month) }}"
                   class="btn btn-danger">
                    <i class="fas fa-file-pdf"></i> Download PDF
                </a>

                <a href="{{ url_for('ngo_admin_dashboard') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>

        <!-- Financial Summary -->
        <div class="consolidated-card">
            <div class="card-header-custom">
                <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Financial Summary</h5>
            </div>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">Opening Balance</div>
                    <div class="summary-value">₹{{ "%.2f"|format(opening_balance) }}</div>
                </div>

                <div class="summary-item positive">
                    <div class="summary-label">Total Deposits</div>
                    <div class="summary-value">₹{{ "%.2f"|format(total_deposits) }}</div>
                    <small class="text-muted">{{ deposit_count }} transactions</small>
                </div>

                <div class="summary-item negative">
                    <div class="summary-label">Total Expenditures</div>
                    <div class="summary-value">₹{{ "%.2f"|format(total_expenditures) }}</div>
                    <small class="text-muted">{{ expense_count }} expenses</small>
                </div>

                <div class="summary-item {% if available_balance >= 0 %}positive{% else %}negative{% endif %}">
                    <div class="summary-label">Available Balance</div>
                    <div class="summary-value">₹{{ "%.2f"|format(available_balance) }}</div>
                </div>

                <div class="summary-item positive">
                    <div class="summary-label">Budget Approved</div>
                    <div class="summary-value">₹{{ "%.2f"|format(total_approved) }}</div>
                    <small class="text-muted">{{ approval_count }} approvals</small>
                </div>

                <div class="summary-item {% if remaining_budget >= 0 %}positive{% else %}negative{% endif %}">
                    <div class="summary-label">Remaining Budget</div>
                    <div class="summary-value">₹{{ "%.2f"|format(remaining_budget) }}</div>
                </div>
            </div>
        </div>

<!--        &lt;!&ndash; Key Metrics &ndash;&gt;-->
<!--        <div class="row mb-4">-->
<!--            <div class="col-md-4">-->
<!--                <div class="consolidated-card">-->
<!--                    <div class="card-body text-center">-->
<!--                        <i class="fas fa-money-bill-wave fa-2x text-success mb-2"></i>-->
<!--                        <h5>Net Cash Flow</h5>-->
<!--                        <h3 class="{% if (total_deposits - total_expenditures) >= 0 %}text-success{% else %}text-danger{% endif %}">-->
<!--                            ₹{{ "%.2f"|format(total_deposits - total_expenditures) }}-->
<!--                        </h3>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="col-md-4">-->
<!--                <div class="consolidated-card">-->
<!--                    <div class="card-body text-center">-->
<!--                        <i class="fas fa-percentage fa-2x text-info mb-2"></i>-->
<!--                        <h5>Expense Ratio</h5>-->
<!--                        <h3 class="text-info">-->
<!--                            {% if total_deposits > 0 %}-->
<!--                                {{ "%.1f"|format((total_expenditures / total_deposits) * 100) }}%-->
<!--                            {% else %}-->
<!--                                0%-->
<!--                            {% endif %}-->
<!--                        </h3>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
            <div class="col-md-4">
                <div class="consolidated-card">
                    <div class="card-body text-center">
                        <i class="fas fa-balance-scale fa-2x text-warning mb-2"></i>
                        <h5>Budget Utilization</h5>
                        <h3 class="text-warning">
                            {% if total_approved > 0 %}
                                {{ "%.1f"|format((total_expenditures / total_approved) * 100) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transaction Details -->
        <div class="consolidated-card">
            <div class="card-header-custom d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-list"></i> Transaction Details</h5>
                <span class="badge bg-light text-dark">{{ transactions|length }} transactions</span>
            </div>
            <div class="table-responsive">
                <table class="table table-hover transaction-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Description</th>
                            <th>Category</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for transaction in transactions %}
                        <tr>
                            <td>
                                {% if transaction.date %}
                                    {{ transaction.date.strftime('%d/%m/%Y') }}
                                {% else %}
                                    N/A
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge {% if transaction.type == 'Donation' %}badge-donation
                                                  {% elif transaction.type == 'Expenditure' %}badge-expenditure
                                                  {% else %}badge-approval{% endif %}">
                                    {{ transaction.type }}
                                </span>
                            </td>
                            <td class="fw-bold {% if transaction.type == 'Donation' %}text-success{% else %}text-danger{% endif %}">
                                ₹{{ "%.2f"|format(transaction.amount) }}
                            </td>
                            <td>{{ transaction.description or 'N/A' }}</td>
                            <td>
                                <span class="badge bg-secondary">
                                    {{ transaction.category or 'N/A' }}
                                </span>
                            </td>
                            <td>
                                <span class="badge {% if transaction.status == 'Completed' %}bg-success{% else %}bg-warning{% endif %}">
                                    {{ transaction.status }}
                                </span>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="6" class="text-center py-4">
                                <i class="fas fa-inbox fa-2x text-muted mb-2"></i>
                                <p class="text-muted">No transactions found for this period</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>