<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Expenditures</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container { max-width: 95%; }
        .table th { background-color: #2c3e50; color: white; }
        .back-btn { margin-bottom: 20px; }
    </style>
</head>
<body>
<div class="container mt-4">
    <a href="{% if user_role == 'admin' %}{{ url_for('ngo_admin_dashboard') }}{% else %}{{ url_for('ngo_accountant_dashboard') }}{% endif %}" class="btn btn-secondary back-btn">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>

    <h2 class="text-center mb-4">Expenditure Records</h2>

    {% if expenditures %}
    <div class="text-end mb-3">
        {% if user_role == 'admin' %}
            <a href="{{ url_for('download_expenditure_report_admin') }}" class="btn btn-success">
                <i class="fas fa-file-pdf"></i> Download PDF
            </a>
        {% else %}
            <a href="{{ url_for('download_expenditure_report_accountant') }}" class="btn btn-success">
                <i class="fas fa-file-pdf"></i> Download PDF
            </a>
        {% endif %}
    </div>

    <div class="table-responsive">
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    {% if user_role == 'admin' %}
                        <th>NGO Name</th>
                    {% endif %}
                    <th>Program Name</th>
                    <th>Approved Budget (₹)</th>
                    <th>This Expense (₹)</th>
                    <th>Remaining After This (₹)</th>
                    <th>Spending Date</th>
                    <th>Paid To</th>
                    <th>Payment Method</th>
                    <th>Location</th>
                    <th>Receipt No.</th>
                    <th>Details</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for exp in expenditures %}
                <tr>
                    <td>{{ exp.id }}</td>
                    {% if user_role == 'admin' %}
                        <td>{{ exp.ngo_name or '-' }}</td>
                    {% endif %}
                    <td>{{ exp.program_name or '-' }}</td>
                    <td class="fw-bold">₹{{ exp.approved_amount or '0' }}</td>
                    <td class="text-danger fw-bold">₹{{ exp.amount_spent or '0' }}</td>
                    <td class="{% if (exp.remaining_after or 0) < 0 %}text-danger{% elif (exp.remaining_after or 0) == 0 %}text-warning{% else %}text-success{% endif %} fw-bold">
                        ₹{{ exp.remaining_after or '0' }}
                    </td>
                    <td>{{ exp.spending_date.strftime('%d %b %Y') if exp.spending_date else '-' }}</td>
                    <td>{{ exp.paid_to or '-' }}</td>
                    <td>{{ exp.payment_method or '-' }}</td>
                    <td>{{ exp.location or '-' }}</td>
                    <td>{{ exp.receipt_number or '-' }}</td>
                    <td>{{ exp.details or '-' }}</td>
                    <td>{{ exp.notes or '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <div class="alert alert-info text-center">
            <h4>No Expenditure Records</h4>
            <p>No expenses have been recorded yet.</p>
        </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>